<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta property="og:type" content="website">
<meta property="og:title" content="Daily Life">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Daily Life">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Daily Life">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'Author'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/"/>

  <title> Daily Life </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Daily Life</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/04/Advanced-UNIX-Programming-Ch8/" itemprop="url">
                  Advanced-UNIX-Programming-Ch8
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-12-04T00:39:49+08:00" content="2016-12-04">
              2016-12-04
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><h3 id="Process-IdenIfiers"><a href="#Process-IdenIfiers" class="headerlink" title="Process IdenIfiers"></a>Process IdenIfiers</h3><blockquote>
<ul>
<li>每個 process 都有獨一無二的 ID</li>
</ul>
<blockquote>
<p>是一個非負的整數<br>在一個 process 結束後，process ID 可以被重複使用<br>Process ID 0 一般是 scheduler process ，又稱為 swapper （是 kernel 的一部分，是 system process）<br>Process ID 1 一般是 init process ，在 bootstrap 程序的最後被 kernel invoke</p>
</blockquote>
<h4 id="init-program"><a href="#init-program" class="headerlink" title="init program"></a>init program</h4><ul>
<li><p>/sbin/init</p>
</li>
<li><p>Bring up the system - /etc/iniVab, /etc/rc*, or /etc/events.d</p>
</li>
<li><p>The init process never dies</p>
</li>
<li><p>The parent process of all orphan processes</p>
<blockquote>
<p>nohup, and daemon processes</p>
</blockquote>
</li>
<li><p>Several init replacements have been proposed –  Upstart, Epoch, Mudar, and systemd</p>
</li>
</ul>
<h4 id="相關指令：ps"><a href="#相關指令：ps" class="headerlink" title="相關指令：ps"></a>相關指令：ps</h4><p>列出系統中當前運行的 process</p>
<h4 id="相關指令：top"><a href="#相關指令：top" class="headerlink" title="相關指令：top"></a>相關指令：top</h4><p>顯示系統中各個 process 佔用 resource 的情況<br>取代 top 的指令：<a href="http://blog.xuite.net/tolarku/blog/66114556-htop+觀測系統的狀態+-+取代+top+指令" target="_blank" rel="external">htop</a></p>
<h4 id="相關指令：pstree"><a href="#相關指令：pstree" class="headerlink" title="相關指令：pstree"></a>相關指令：pstree</h4><p>方便可以看到 process 間的關聯性</p>
<h4 id="取得-process-ID-的-function"><a href="#取得-process-ID-的-function" class="headerlink" title="取得 process ID 的 function"></a>取得 process ID 的 function</h4><p>getpid, getppid, getuid, geteuid, getgid, getegid</p>
<p>要注意的是上述 function 都不會回傳錯誤</p>
</blockquote>
<h2 id="Process-creation"><a href="#Process-creation" class="headerlink" title="Process creation"></a>Process creation</h2><h3 id="fork"><a href="#fork" class="headerlink" title="fork"></a>fork</h3><p>&gt;</p>
<blockquote>
<p>創建一個新的（child）process</p>
<h4 id="Synopsis"><a href="#Synopsis" class="headerlink" title="Synopsis"></a>Synopsis</h4><ul>
<li><p>pid_t fork(void);</p>
</li>
<li><p>Returns: 0 in child, process ID of child in parent, -1 on error</p>
</li>
</ul>
<h4 id="呼叫-fork-之後"><a href="#呼叫-fork-之後" class="headerlink" title="呼叫 fork 之後"></a>呼叫 fork 之後</h4><ul>
<li><p>child 和 parent process 都會繼續執行 fork 後的指令</p>
</li>
<li><p>child process 會複製 parent process 的 data space、 heap 和 stack，但並不共享這些部分的記憶體</p>
</li>
<li><p>child process 會和 parent process 共享 text segment的記憶體</p>
</li>
<li><p>因為 fork function 之後常會跟著呼叫 exec，copy-on- write (COW) 技術因此出現：當記憶體被複製但未被改變，則不必要 allocate 新的記憶體</p>
</li>
</ul>
<h4 id="fork-and-File-Sharing"><a href="#fork-and-File-Sharing" class="headerlink" title="fork and File Sharing"></a>fork and File Sharing</h4><p><img src="forkandFileSharing.png" alt="Alt text" title="fork and File Sharing"></p>
<h4 id="Uses-of-fork"><a href="#Uses-of-fork" class="headerlink" title="Uses of fork"></a>Uses of fork</h4><ul>
<li><p>When a process wants to duplicate itself</p>
<blockquote>
<p>The parent and child can each execute different sections of code at the same time<br>common for network servers</p>
</blockquote>
</li>
<li><p>When a process wants to execute a different program</p>
<blockquote>
<p>common for shells</p>
</blockquote>
</li>
</ul>
</blockquote>
<h3 id="Variants-of-fork"><a href="#Variants-of-fork" class="headerlink" title="Variants of fork"></a>Variants of fork</h3><p>&gt;</p>
<blockquote>
<h4 id="vfork"><a href="#vfork" class="headerlink" title="vfork"></a>vfork</h4><ul>
<li><p>Creates a child process of the calling process without copying the address space of the parent into the child</p>
</li>
<li><p>Usually used when the child simply calls exec (or exit) right after the vfork</p>
</li>
<li><p>While the child is running and unIl it calls either exec or exit, the child runs in the address space of the parent (So if the child modifies any data, the result is undefined)</p>
</li>
<li><p>More efficient than use fork – no copy is beVer than some copies (i.e. COW)</p>
</li>
<li><p>Guarantee child run first. When the child calls exec or exit, the parent resumes. So if the child depends on further actions of the parent before calling exec or exit, deadlock occurs. </p>
</li>
</ul>
<h4 id="clone"><a href="#clone" class="headerlink" title="clone"></a>clone</h4><ul>
<li><p>Linux system calls for implemenIng fork and vfork</p>
</li>
<li><p>A generalized form of fork that allows the caller to control what is shared between parent and child</p>
</li>
</ul>
</blockquote>
<h2 id="Process-termination"><a href="#Process-termination" class="headerlink" title="Process termination"></a>Process termination</h2><p>&gt;<br>&gt;<br>&gt;<br>&gt;<br>&gt;<br>&gt;<br>&gt;</p>
<h2 id="Program-execution"><a href="#Program-execution" class="headerlink" title="Program execution"></a>Program execution</h2><p>&gt;<br>&gt;<br>&gt;<br>&gt;<br>&gt;<br>&gt;<br>&gt;</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/03/Advanced-UNIX-Programming-Ch7/" itemprop="url">
                  Advanced-UNIX-Programming-Ch7
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-12-03T18:49:04+08:00" content="2016-12-03">
              2016-12-03
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Process-start-and-termination"><a href="#Process-start-and-termination" class="headerlink" title="Process start and termination"></a>Process start and termination</h2><h3 id="main-function"><a href="#main-function" class="headerlink" title="main function"></a>main function</h3><blockquote>
<h4 id="Synopsis"><a href="#Synopsis" class="headerlink" title="Synopsis"></a>Synopsis</h4><p>int main(int argc, char *argv[]);</p>
<ul>
<li><p>argc: 來自command-line 參數的數量</p>
</li>
<li><p>argv: 裝著指著參數的pointer的陣列</p>
</li>
</ul>
<p>當C程式被 kernel 執行的時候(其實是被其中一個 exec 函式執行），在 main function 實際上被叫起來做事前，會有一整個 start-up routine 被呼叫。<br>參考:<a href="http://www.voidcn.com/blog/vanquishedzxl/article/p-3193131.html" target="_blank" rel="external">Linux kernel 分析之二:main函数执行启动过程</a></p>
</blockquote>
<h3 id="Process-Termination"><a href="#Process-Termination" class="headerlink" title="Process Termination"></a>Process Termination</h3><blockquote>
<h4 id="結束的情況有："><a href="#結束的情況有：" class="headerlink" title="結束的情況有："></a>結束的情況有：</h4><ul>
<li><p>正常結束</p>
<blockquote>
<ul>
<li>從 main return</li>
<li>呼叫 exit</li>
<li>呼叫 _exit 或 _Exit</li>
<li>最後一個 thread return</li>
<li>最後一個 thread 呼叫 pthread_exit</li>
</ul>
</blockquote>
</li>
<li><p>不正常結束</p>
<blockquote>
<ul>
<li>呼叫abort</li>
<li>收到 signal</li>
<li>最後一個 thread cancel</li>
</ul>
</blockquote>
</li>
</ul>
<p>上述提到的 start-up routine，當 main function return 後，會呼叫 exit 結束它（常常以assembly 寫）。</p>
<h4 id="Exit-Functions"><a href="#Exit-Functions" class="headerlink" title="Exit Functions"></a>Exit Functions</h4><ul>
<li><p>exit：會做清理的動作才返回 kernel，像是呼叫 fclose 關掉所有的 open stream。（這會讓所有 buffered outputdata 被寫到檔案中）</p>
</li>
<li><p>_exit and _Exit：直接返回 kernel</p>
</li>
<li><p>atexit: exit handlers</p>
</li>
</ul>
<p><img src="StartandTerminationofaCProgram.png" alt="Alt text" title="Start and Termination of a C Program"></p>
<h4 id="討論：未定義-main-function-返回-int-且未-return值的情況，會得到什麼-exit-code"><a href="#討論：未定義-main-function-返回-int-且未-return值的情況，會得到什麼-exit-code" class="headerlink" title="討論：未定義 main function 返回 int 且未 return值的情況，會得到什麼 exit code?"></a>討論：未定義 main function 返回 int 且未 return值的情況，會得到什麼 exit code?</h4><h4 id="補充：lint-指令"><a href="#補充：lint-指令" class="headerlink" title="補充：lint 指令"></a>補充：lint 指令</h4><p>標記原始碼中有疑義的部分</p>
</blockquote>
<h2 id="Environment-variables"><a href="#Environment-variables" class="headerlink" title="Environment variables"></a>Environment variables</h2><blockquote>
<ul>
<li><p>格式: name=value(＝前後皆無空白)</p>
</li>
<li><p>相關指令：env, export (bash)</p>
</li>
<li><p>在 shell 中用$來讀</p>
</li>
</ul>
<h4 id="Environment-list"><a href="#Environment-list" class="headerlink" title="Environment list"></a>Environment list</h4><ul>
<li><p>extern char **environ;</p>
</li>
<li><p>是一個裝著 char pointer 的陣列，其中每一個 pointer 裝著一個以 null 結尾的 C string 位址</p>
</li>
</ul>
<p><img src="EnvironmentList.png" alt="Alt text" title="Environment List"></p>
</blockquote>
<h2 id="Memory-layout"><a href="#Memory-layout" class="headerlink" title="Memory layout"></a>Memory layout</h2><p>&gt;</p>
<blockquote>
<p><img src="MemoryLayout.png" alt="Alt text" title="Memory Layout of a Program"></p>
<ul>
<li><p>Text segment: Machine instructions</p>
</li>
<li><p>Initialized data segment: eg. int maxcount = 100;</p>
</li>
<li><p>Uninitialized data segment (bss): eg. long sum[1000];</p>
</li>
<li><p>Stack: Local variables, function call states</p>
</li>
<li><p>Heap: Dynamic allocated memory</p>
</li>
</ul>
<h4 id="size-指令"><a href="#size-指令" class="headerlink" title="size 指令"></a>size 指令</h4><p>單位：byte</p>
</blockquote>
<h2 id="Shared-libraries"><a href="#Shared-libraries" class="headerlink" title="Shared libraries"></a>Shared libraries</h2><p>&gt;</p>
<blockquote>
<ul>
<li><p>減少執行檔的 common library routine</p>
</li>
<li><p>Maintain 一份 library routine 在記憶體裡供所有 process reference</p>
<blockquote>
<p>這可能會增加一些 runtime overhead</p>
</blockquote>
</li>
</ul>
<p>程式可以使用新版的 library function 在不用 relink 到每一個用到該 libray 程式的情況下</p>
<blockquote>
<p>這可能會有安全性問題</p>
</blockquote>
<h4 id="Library-Injection"><a href="#Library-Injection" class="headerlink" title="Library Injection"></a>Library Injection</h4><ul>
<li><p>被 shared libraries reference 的 function 可以被 overridden</p>
</li>
<li><p>The LD_PRELOAD environment variable </p>
</li>
</ul>
<blockquote>
<p>LD_PRELOAD=/path/to/the/injected-shared-object {program}</p>
</blockquote>
<ul>
<li><p>不能和 suid/sgid 一起用</p>
</li>
<li><p>相關指令：file, ldd, nm, strip </p>
</li>
</ul>
</blockquote>
<h2 id="Memory-allocation"><a href="#Memory-allocation" class="headerlink" title="Memory allocation"></a>Memory allocation</h2><p>&gt;</p>
<blockquote>
<p>ISO C</p>
<ul>
<li><p>void *malloc(size_t size);</p>
<blockquote>
<p>初始值未定</p>
</blockquote>
</li>
<li><p>void *calloc(size_t nobj, size_t size);</p>
<blockquote>
<p>初始值為 0</p>
</blockquote>
</li>
</ul>
<p><em>void </em>realloc(void *ptr, size_t newsize);</p>
<blockquote>
<p>初始值未定</p>
</blockquote>
<p>released by free()</p>
<p>通常以 system call: sbrk(2) 實作</p>
<p>以上三個記憶體皆被要在 heap，free 時記憶體並非被還給 kernel，而是保存在 malloc pool 中</p>
<p>如果一個 process 呼叫 malloc，但沒有呼叫 free，則它的記憶體使用會繼續增長，這就稱為 leakage</p>
<blockquote>
<p>這可能會因過度的 paging overhead 而造成程式效能下降 </p>
</blockquote>
<p>#include <alloca.h></alloca.h></p>
<ul>
<li>void *alloca(size_t size);</li>
</ul>
<p>記憶體被要在stack，所以也不需在使用完後 free 掉記憶體</p>
</blockquote>
<h2 id="setjmp-and-longjmp"><a href="#setjmp-and-longjmp" class="headerlink" title="setjmp and longjmp"></a>setjmp and longjmp</h2><p>&gt;</p>
<blockquote>
<p>因為 goto 只能被用在同一個 function 中，我們必須有 setjmp 和 longjmp 來跳到不同的 function</p>
<h4 id="setjmp"><a href="#setjmp" class="headerlink" title="setjmp"></a>setjmp</h4><p>int setjmp(jmp_buf env);</p>
<p>設定跳回的位址</p>
<ul>
<li>env: 通常是一個 global 變數，要可以被 setjmp 和 longjmp 兩方存取 </li>
</ul>
<p>如果是直接呼叫，會回傳 0；如果是自 longjmp 返回，會回傳非 0</p>
<h4 id="longjmp"><a href="#longjmp" class="headerlink" title="longjmp"></a>longjmp</h4><p>void longjmp(jmp_buf env, int val);</p>
<p>跳回</p>
<ul>
<li><p>val 是 setjmp 的返回值</p>
</li>
<li><p>如果 val 是 0，將會被取代為 1</p>
</li>
</ul>
<h4 id="Restoration-of-Variables"><a href="#Restoration-of-Variables" class="headerlink" title="Restoration of Variables"></a>Restoration of Variables</h4><p>變數類型</p>
<ul>
<li><p>Automatic: the default</p>
</li>
<li><p>Register: store in register if possible</p>
</li>
<li><p>Volatile: store in memory</p>
</li>
</ul>
<p>variables in register – restored; variables in memory – kept</p>
<ul>
<li><p>auto variables may be indeterminate, it depends on compiler<br>implementations</p>
</li>
<li><p>register variables are restored to the value of “before calling setjmp”</p>
</li>
<li><p>volatile variable are restored to the value of “before calling longjmp”</p>
</li>
</ul>
</blockquote>
<h2 id="Process-resource-limits"><a href="#Process-resource-limits" class="headerlink" title="Process resource limits"></a>Process resource limits</h2><p>&gt;</p>
<blockquote>
<ul>
<li><p>每個 process 都有 resource 限制</p>
</li>
<li><p>通常是由 parent process 初始化後，該 parent process 的 child process 繼承之</p>
</li>
<li><p>getrlimit 和 setrlimit function</p>
</li>
<li><p>rlimit structure</p>
</li>
</ul>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/13/VP8/" itemprop="url">
                  VP8
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-11-13T17:02:27+08:00" content="2016-11-13">
              2016-11-13
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><h3 id="Codec"><a href="#Codec" class="headerlink" title="Codec"></a>Codec</h3><ul>
<li>codec 一詞來自於coder-decoder，意即編解碼器</li>
<li>是一種會對 signal 或 data stream 做編碼或解碼動作的程式，也可以是一個 device</li>
<li>codec 編碼的目的是為了傳輸、儲存、加密 signal 或 data stream，再藉由解碼來還原原本的 signal 或 data stream </li>
</ul>
<h3 id="Motion-Estimation"><a href="#Motion-Estimation" class="headerlink" title="Motion Estimation"></a>Motion Estimation</h3><p>運動向量估計是影像壓縮中是最重要也是運算量最大的部分</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/05/Advanced-UNIX-Programming-Ch6/" itemprop="url">
                  Advanced UNIX Programming--Ch6
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-11-05T16:04:03+08:00" content="2016-11-05">
              2016-11-05
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><h2 id="Password"><a href="#Password" class="headerlink" title="Password"></a>Password</h2><h2 id="Group"><a href="#Group" class="headerlink" title="Group"></a>Group</h2><h2 id="Accounting"><a href="#Accounting" class="headerlink" title="Accounting"></a>Accounting</h2><h2 id="System-Identification"><a href="#System-Identification" class="headerlink" title="System Identification"></a>System Identification</h2><h2 id="Time-and-Date-Routines"><a href="#Time-and-Date-Routines" class="headerlink" title="Time and Date Routines"></a>Time and Date Routines</h2>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/29/Advanced-UNIX-Programming-Ch4/" itemprop="url">
                  Advanced UNIX Programming--Ch4
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-10-29T19:18:06+08:00" content="2016-10-29">
              2016-10-29
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>這一章繼上一章談 regular files 的 I/O 操作，像是開檔、讀寫檔以外，討論了檔案系統及檔案的其他特性。</p>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><h3 id="檔名"><a href="#檔名" class="headerlink" title="檔名"></a>檔名</h3><blockquote>
<h4 id="避免使用一些特殊符號命名"><a href="#避免使用一些特殊符號命名" class="headerlink" title="避免使用一些特殊符號命名"></a>避免使用一些特殊符號命名</h4><ul>
<li><p>避免使用：* ? &gt; &lt; ; &amp; ! [ ] | \ ‘ “ ` ( ) { }</p>
</li>
<li><p>下option時，會使用-，所以也不建議使用-開頭命名檔案</p>
</li>
<li><p>此外，.開頭的檔案為隱藏檔</p>
</li>
</ul>
<h4 id="每一個檔案或目錄的檔名最長可以到達-255-個字元（PATH-MAX-constant）"><a href="#每一個檔案或目錄的檔名最長可以到達-255-個字元（PATH-MAX-constant）" class="headerlink" title="每一個檔案或目錄的檔名最長可以到達 255 個字元（PATH_MAX constant）"></a>每一個檔案或目錄的檔名最長可以到達 255 個字元（PATH_MAX constant）</h4></blockquote>
<h3 id="路徑名"><a href="#路徑名" class="headerlink" title="路徑名"></a>路徑名</h3><blockquote>
<h4 id="絕對路徑-vs-相對路徑"><a href="#絕對路徑-vs-相對路徑" class="headerlink" title="絕對路徑 vs. 相對路徑"></a>絕對路徑 vs. 相對路徑</h4><ul>
<li>Absolute pathname – with a leading slash</li>
<li>Relative pathname – without a leading slash or with a dot</li>
</ul>
<h4 id="每一個路徑名最長可以到達-4096-個字元"><a href="#每一個路徑名最長可以到達-4096-個字元" class="headerlink" title="每一個路徑名最長可以到達 4096 個字元"></a>每一個路徑名最長可以到達 4096 個字元</h4></blockquote>
<h3 id="目錄"><a href="#目錄" class="headerlink" title="目錄"></a>目錄</h3><blockquote>
<h4 id="Working-Directory-vs-Home-Directory"><a href="#Working-Directory-vs-Home-Directory" class="headerlink" title="Working Directory vs. Home Directory"></a>Working Directory vs. Home Directory</h4><ul>
<li>Working Directory (current working directory, cwd): 每個 process 都有一個 cwd</li>
<li>Home Directory: 當使用者log in後初始的 working directory (來自 /etc/passwd)</li>
</ul>
</blockquote>
<h2 id="File-Info"><a href="#File-Info" class="headerlink" title="File Info"></a>File Info</h2><h3 id="stat-lstat-fstat-fstatat"><a href="#stat-lstat-fstat-fstatat" class="headerlink" title="stat, lstat, fstat, fstatat"></a>stat, lstat, fstat, fstatat</h3><blockquote>
<ul>
<li>stat 和 lstat  基本上是相等的，只是 當檔案是一個 symbolic link 時，lstat 會回傳 symbolic link 資訊，而非 symbolic link 指到的檔案；stat 會回傳 symbolic link 指到的檔案的資訊</li>
</ul>
<p>Try:</p>
<blockquote>
<pre><code class="bash">ls <span class="_">-l</span> /var
</code></pre>
</blockquote>
<p>More info: <a href="http://stackoverflow.com/questions/3984948/man-2-stat-how-to-figure-out-if-a-file-is-a-link" target="_blank" rel="external">figure out if a file is a link</a></p>
<ul>
<li>fstat 會對已開的檔案做一樣的事</li>
<li>fstatat 會依給予 flag 參數的不同而做和 stat 或 lstat 一樣的事</li>
</ul>
</blockquote>
<h3 id="常見的檔案資訊"><a href="#常見的檔案資訊" class="headerlink" title="常見的檔案資訊"></a>常見的檔案資訊</h3><blockquote>
<ul>
<li>File type and permissions</li>
<li>Number of hard links</li>
<li>User ID and group ID</li>
<li>Device number (of the containing file system)</li>
<li>Device number for special files</li>
<li>File size</li>
<li>Block size and number of used blocks  </li>
<li>Timestamps: access, modificaIon, and change</li>
</ul>
</blockquote>
<h3 id="檔案類型"><a href="#檔案類型" class="headerlink" title="檔案類型"></a>檔案類型</h3><blockquote>
<ul>
<li>Regular file</li>
<li>Directory file</li>
<li>Block special file</li>
<li>Character special file </li>
<li>FIFO</li>
<li>Socket</li>
<li>Symbolic link</li>
</ul>
</blockquote>
<h2 id="File-Permissions"><a href="#File-Permissions" class="headerlink" title="File Permissions"></a>File Permissions</h2><h3 id="UIDs-和-GIDs"><a href="#UIDs-和-GIDs" class="headerlink" title="UIDs 和 GIDs"></a>UIDs 和 GIDs</h3><blockquote>
<p>由於帳號的比對過於麻煩，所以實際上 UNIX 系統只記錄相對應該帳號的 id 數字來進行登入後的操作(在 /etc/passwd 中)。可以使用 id 指令來查看在系統中的帳號的 UID 和 GIDs</p>
<p>More info: <a href="http://linux.vbird.org/linux_basic/0410accountmanager.php#account_id" target="_blank" rel="external">使用者識別碼： UID 與 GID</a></p>
<h4 id="每個-process-都會有的-UIDs-和-GIDs"><a href="#每個-process-都會有的-UIDs-和-GIDs" class="headerlink" title="每個 process 都會有的 UIDs 和 GIDs"></a>每個 process 都會有的 UIDs 和 GIDs</h4><ul>
<li>Real user ID and real group ID：來自 /etc/passwd，代表檔案的 owner</li>
<li>Effective user ID and effective group ID：檢查檔案存取權限，代表 process 的存取權限<blockquote>
<p>一般而言與real user ID 和 effective group ID 相等，但可被執行中的程式用 setuid(2) 或 setgid(2)設定。</p>
</blockquote>
</li>
<li>Saved set-user-ID and saved set-group-ID：exec<blockquote>
<p>passwd 便是一個 set-user-ID 的程式<br>More info: <a href="http://linux.vbird.org/linux_basic/0410accountmanager.php#account_user" target="_blank" rel="external">/etc/passwd 和 /etc/shadow</a></p>
</blockquote>
</li>
</ul>
</blockquote>
<h3 id="檔案存取權限"><a href="#檔案存取權限" class="headerlink" title="檔案存取權限"></a>檔案存取權限</h3><blockquote>
<h4 id="9-bit-permissions"><a href="#9-bit-permissions" class="headerlink" title="9-bit permissions"></a>9-bit permissions</h4><ul>
<li>user-read, user-write, user-execute （這裡的user，即指檔案的所有者）</li>
<li>group-read, group-write, group-execute</li>
<li>other-read, other-write, other-execute<br>要刪除/創建一個存在的檔案，我們需要有該檔案所在目錄寫和執行的權限</li>
</ul>
<h4 id="EUID-判斷是否能存取檔案是循著一定順序，sequential-決定的"><a href="#EUID-判斷是否能存取檔案是循著一定順序，sequential-決定的" class="headerlink" title="EUID 判斷是否能存取檔案是循著一定順序，sequential 決定的"></a>EUID 判斷是否能存取檔案是循著一定順序，sequential 決定的</h4><h4 id="任何一個檔案要能被開啟，都必須擁有該檔案所在所有路徑目錄的-execute-權限"><a href="#任何一個檔案要能被開啟，都必須擁有該檔案所在所有路徑目錄的-execute-權限" class="headerlink" title="任何一個檔案要能被開啟，都必須擁有該檔案所在所有路徑目錄的 execute 權限"></a>任何一個檔案要能被開啟，都必須擁有該檔案所在所有路徑目錄的 execute 權限</h4><blockquote>
<p>read 全縣能讓我們獲得該目錄所有的檔案的 list，但 execute 權限讓我們可以比對一個特定的檔案名字</p>
</blockquote>
</blockquote>
<h3 id="新檔案和目錄的所有權"><a href="#新檔案和目錄的所有權" class="headerlink" title="新檔案和目錄的所有權"></a>新檔案和目錄的所有權</h3><blockquote>
<h4 id="新檔案的-UID-是被設定為創建這個檔案的-process-的-EUID"><a href="#新檔案的-UID-是被設定為創建這個檔案的-process-的-EUID" class="headerlink" title="新檔案的 UID 是被設定為創建這個檔案的 process 的 EUID"></a>新檔案的 UID 是被設定為創建這個檔案的 process 的 EUID</h4><h4 id="新檔案的-GID-則是視作業系統，可能由以下兩種方式決定："><a href="#新檔案的-GID-則是視作業系統，可能由以下兩種方式決定：" class="headerlink" title="新檔案的 GID 則是視作業系統，可能由以下兩種方式決定："></a>新檔案的 GID 則是視作業系統，可能由以下兩種方式決定：</h4><ul>
<li>創建這個檔案的 process 的 EGID</li>
<li>父目錄的 GID<blockquote>
<ul>
<li>Linux 是由 mount option (grpid) 來決定，若 grpid 被設定或是目錄有 SGID，則該檔案的 GID 是父目錄的 GID，像是mkdir；否則是創建這個檔案的 process 的 EGID</li>
<li>FreeBSD 5.2.1/Mac OS X 10.3，該檔案的 GID 是父目錄的 GID</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<h3 id="access"><a href="#access" class="headerlink" title="access"></a>access</h3><blockquote>
<p>不同於剛剛提到以 process 角度，檢查 EUID 和 EGID 來決定是否有檔案的存取權限，access 這個 function 以 user （也就是 owner ）的觀點來檢查是否有檔案的存取權限。</p>
<blockquote>
<p>有另一個類似的 function：faccessat，但當該 function 的 flag 參數設為 AT_EACCESS 時，是以EUID 和 EGID 來決定是否有檔案的存取權限。</p>
</blockquote>
<p>Try: (This example is from Advanced Programming in the UNIX Environment, 3rd Edition )</p>
<blockquote>
<pre><code class="bash">$ ls <span class="_">-l</span> a.out
-rwxrwxr-x 1 sar 15945 Nov 30 12:10 a.out
$ ./a.out a.out
<span class="built_in">read</span> access OK
open <span class="keyword">for</span> reading OK
$ ls <span class="_">-l</span> /etc/shadow
-r-------- 1 root 1315 Jul 17 2002 /etc/shadow
./a.out /etc/shadow
access error <span class="keyword">for</span> /etc/shadow: Permission denied
open error <span class="keyword">for</span> /etc/shadow: Permission denied
sudo su -
Password:
$ chown root a.out
$ chmod u+s a.out
$ ls <span class="_">-l</span> a.out
-rwsrwxr-x 1 root 15945 Nov 30 12:10 a.out
$ <span class="built_in">exit</span>
$ ./a.out /etc/shadow
access error <span class="keyword">for</span> /etc/shadow: Permission denied
open <span class="keyword">for</span> reading OK
</code></pre>
</blockquote>
<p>判斷real user 是無法讀取 /etc/shadow，但 open 卻仍然會成功，因為以 root 身份執行  </p>
</blockquote>
<h3 id="umask"><a href="#umask" class="headerlink" title="umask"></a>umask</h3><h2 id="File-Systems"><a href="#File-Systems" class="headerlink" title="File Systems"></a>File Systems</h2><h2 id="Directory-OperaIons"><a href="#Directory-OperaIons" class="headerlink" title="Directory OperaIons"></a>Directory OperaIons</h2><h2 id="Device-Special-Files"><a href="#Device-Special-Files" class="headerlink" title="Device Special Files"></a>Device Special Files</h2>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/16/How-to-run-find-with-exec/" itemprop="url">
                  How to run find with -exec
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-10-16T15:59:46+08:00" content="2016-10-16">
              2016-10-16
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>UNIX allows users to pipe each utility’s output to another utility’s input to accomplish complicated tasks.</p>
<h3 id="Find-command-with-exec"><a href="#Find-command-with-exec" class="headerlink" title="Find command with -exec"></a>Find command with -exec</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ find . -name <span class="string">'*.txt'</span> -exec grep -i apple &#123;&#125; \;</div></pre></td></tr></table></figure>
<p>We first find txt file in this directory. Then, execute grep and substitute {} with the results we just found. That is, the filenames.</p>
<h3 id="Result"><a href="#Result" class="headerlink" title="Result"></a>Result</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">I like to eat apples.</div></pre></td></tr></table></figure>
<p>If we want to display the filename the matched lines are in, we can change the command above to</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ find . -name <span class="string">'*.txt'</span> -exec grep -i apple &#123;&#125; +;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Shelly Yu" />
          <p class="site-author-name" itemprop="name">Shelly Yu</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">6</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">1</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Shelly Yu</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  




  
  

  

  

  

</body>
</html>
